<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Login</title>
    <!-- OsenUi -->
    <link rel="stylesheet" href="../css/onsenui.css">
    <link rel="stylesheet" href="../css/onsen-css-components.min.css">

    <link rel="stylesheet" href="css/global.css">

    <script src="../js/jquery-3.3.1.min.js"></script>
    <script src="../js/onsenui.min.js"></script>
    <script>
        $(document).ready(function () {
            if (
                validarSesion()
                && localStorage.sesion != 'false'
                && localStorage.sesion.trim().length > 0
            ) document.querySelector('#myNavigator').pushPage('../main.html');
            else document.querySelector('#myNavigator').pushPage('login.html');
        })

        function validarSesion() {
            var retornar = false;
            var sesionVar = localStorage.sesion;
            $.ajax({
                url: 'http://192.168.42.146/titanapp/inc/sesion.php',
                data: { sesion: sesionVar },
                type: 'POST',
                async: false,
                dataType: "json",
            }).done(function (data) {
                console.log(data);
                if (data.cod == '00') retornar = true;
                else {
                    localStorage.sesion = false;
                    retornar = false;
                }
            })

            return retornar;
        }
    </script>
</head>

<body>

    <ons-navigator swipeable swipe-target-width="80px" id="myNavigator"></ons-navigator>

    <template id="tabbar.html">
        <ons-page id="tabbar-page">
            <ons-toolbar>
                <div class="center">Inicio</div>
                <div class="left">
                    <ons-toolbar-button onclick="fn.toggleMenu()">
                        <ons-icon icon="ion-navicon, material:md-menu"></ons-icon>
                    </ons-toolbar-button>
                </div>
            </ons-toolbar>
            <ons-tabbar swipeable id="appTabbar" position="bottom">
                <ons-tab label="Inicio" icon="ion-navicon" page="home.html" active></ons-tab>
                <ons-tab label="Clasificados" icon="ion-android-archive" page="forms.html"></ons-tab>
                <ons-tab label="Facturas" icon="ion-cash" page="animations.html"></ons-tab>
            </ons-tabbar>

            <script>
                ons.getScriptPage().addEventListener('prechange', function (event) {
                    if (event.target.matches('#appTabbar')) {
                        event.currentTarget.querySelector('ons-toolbar .center').innerHTML = event.tabItem.getAttribute('label');
                    }
                });
            </script>
        </ons-page>
    </template>


    <template id="home.html">
        <ons-page>
            <div style="text-align: center; margin-top: 30px;">
                <p>
                    <ons-input id="username" modifier="underbar" placeholder="Username" float></ons-input>
                </p>
                <p>
                    <ons-input id="password" modifier="underbar" type="password" placeholder="Password" float>
                    </ons-input>
                </p>
                <p style="margin-top: 30px;">
                    <ons-button onclick="login()">Ingresar</ons-button>
                </p>
            </div>
            <ons-button class="button-margin" id="prueba">Enviar alerta</ons-button>
            <script>
                ons.getScriptPage().onInit = function () {
                    console.log('Test')
                    $('#prueba').click(function () {
                        ons.notification.alert('Alerta de prueba!')
                    })
                }

                function login() {
                    var username = document.getElementById('username').value;
                    var password = document.getElementById('password').value;
                    console.log('Prueba')
                    var data = "123|12345|";
                    $.ajax({
                        url: 'http://www.condominiosenlinea.com/app/m1101v.dll',
                        type: 'POST',
                        // contentType: 'application/json',
                        data: { "importarhtml": data }
                    }).done(function (data) {
                        alert(data)
                    });
                }


            </script>
        </ons-page>
    </template>
    <template id="forms.html">
        <ons-page id="forms-page">
            <ons-list>
                <ons-list-header>Últimas publicaciones</ons-list-header>
                <ons-card onclick="fn.pushPage({'id': 'noticia1.html', 'title': 'Noticia 1'})">
                    <div class="title">Noticia de prueba</div>
                    <div class="content">Click para ver toda la información</div>
                </ons-card>
        </ons-page>
    </template>

    <template id="animations.html">
        <ons-page>
            <!-- <ons-list>
                    <ons-list-header>Transitions</ons-list-header>
                    <ons-list-item modifier="chevron"
                        onclick="fn.pushPage({'id': 'transition.html', 'title': 'none'}, 'none')">
                        none
                    </ons-list-item>
                    <ons-list-item modifier="chevron"
                        onclick="fn.pushPage({'id': 'transition.html', 'title': 'default'}, 'default')">
                        default
                    </ons-list-item>
                    <ons-list-item modifier="chevron"
                        onclick="fn.pushPage({'id': 'transition.html', 'title': 'slide-ios'}, 'slide-ios')">
                        slide-ios
                    </ons-list-item>
                    <ons-list-item modifier="chevron"
                        onclick="fn.pushPage({'id': 'transition.html', 'title': 'slide-md'}, 'slide-md')">
                        slide-md
                    </ons-list-item>
                    <ons-list-item modifier="chevron"
                        onclick="fn.pushPage({'id': 'transition.html', 'title': 'lift-ios'}, 'lift-ios')">
                        lift-ios
                    </ons-list-item>
                    <ons-list-item modifier="chevron"
                        onclick="fn.pushPage({'id': 'transition.html', 'title': 'lift-md'}, 'lift-md')">
                        lift-md
                    </ons-list-item>
                    <ons-list-item modifier="chevron"
                        onclick="fn.pushPage({'id': 'transition.html', 'title': 'fade-ios'}, 'fade-ios')">
                        fade-ios
                    </ons-list-item>
                    <ons-list-item modifier="chevron"
                        onclick="fn.pushPage({'id': 'transition.html', 'title': 'fade-md'}, 'fade-md')">
                        fade-md
                    </ons-list-item>
                </ons-list> -->
        </ons-page>
    </template>
    <template id="noticia1.html">
        <ons-page>
            <ons-toolbar>
                <div class="left">
                    <ons-back-button>Home</ons-back-button>
                </div>
                <div class="center"></div>
                <div class="right">
                    <ons-toolbar-button id="info-button" onclick="fn.showDialog('popover-dialog')"></ons-toolbar-button>
                </div>
            </ons-toolbar>
            <ons-card>
                <div class="title">Noticia de prueba 1</div>
                <div class="content">Simple "pull to refresh" functionality to update data.</div>
            </ons-card>
            <script>
                ons.getScriptPage().onInit = function () {
                    this.querySelector('ons-toolbar div.center').textContent = this.data.title;
                };
            </script>
        </ons-page>
    </template>

    <script type="text/javascript" src="../cordova.js"></script>
    <script>
        window.fn = {};

        window.fn.toggleMenu = function () {
            document.getElementById('appSplitter').left.toggle();
        };

        window.fn.pushPage = function (page, anim) {
            if (anim) {
                document.getElementById('myNavigator').pushPage(page.id, { data: { title: page.title }, animation: anim });
            } else {
                document.getElementById('myNavigator')
                    .pushPage(page.id, { data: { title: page.title } })
            }
        };
    </script>

</body>

</html>