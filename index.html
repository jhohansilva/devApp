<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>App</title>
    <!-- OsenUi -->
    <link rel="stylesheet" href="css/onsenui.css">
    <link rel="stylesheet" href="css/onsen-css-components.min.css">

    <link rel="stylesheet" href="login/css/global.css">
    <link rel="stylesheet" href="css/global/global.css">

    <script src="js/jquery-3.3.1.min.js"></script>
    <script src="js/onsenui.min.js"></script>
    <script>
        $(document).ready(function () {
            if (
                validarSesion()
                && localStorage.sesion != 'false'
                && localStorage.sesion
            ) document.querySelector('#myNavigator').pushPage('paginas/main.html');
            else document.querySelector('#myNavigator').pushPage('login/login.html');

            // else document.querySelector('#myNavigator').pushPage('paginas/main.html');
            // document.querySelector('#myNavigator').pushPage('paginas/main.html');
        })

        function validarSesion() {
            var retornar = false;
            var sesionVar = localStorage.sesion;
            $.ajax({
                url: 'http://80.211.145.146/devp/sesion.php',
                data: { sesion: sesionVar },
                type: 'POST',
                async: false,
                dataType: "json",
            }).done(function (data) {
                console.log(data);
                if (data.cod == '00') retornar = true;
                else {
                    localStorage.sesion = false;
                    retornar = false;
                }
            })

            return retornar;
        }
    </script>
</head>

<body>

    <ons-navigator swipe-target-width="80px" id="myNavigator"></ons-navigator>

    <template id="forms.html">
        <ons-page id="forms-page">
            <ons-list>
                <ons-list-header>Últimas publicaciones</ons-list-header>
                <ons-card onclick="fn.pushPage({'id': 'noticia1.html', 'title': 'Noticia 1'})">
                    <div class="title">Noticia de prueba</div>
                    <div class="content">Click para ver toda la información</div>
                </ons-card>
        </ons-page>
    </template>

    <script type="text/javascript" src="cordova.js"></script>
    <script>
        ons.ready(function () {
            console.log('-> Index');
        });

        window.fn = {};

        window.fn.toggleMenu = function () {
            document.getElementById('appSplitter').left.toggle();
        };

        window.fn.pushPage = function (page, anim) {
            if (anim) {
                document.getElementById('myNavigator').pushPage(page.id, { data: { title: page.title }, animation: anim });
            } else {
                document.getElementById('myNavigator')
                    .pushPage(page.id, { data: { title: page.title } })
            }
        };


    </script>

</body>

</html>